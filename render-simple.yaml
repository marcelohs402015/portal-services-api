# Portal Services API - Render Blueprint (Simple)
# Configuração simplificada para deploy rápido no Render
# 
# Como usar:
# 1. Acesse render.com
# 2. Clique em "New +" -> "Blueprint"
# 3. Conecte seu repositório Git
# 4. O Render detectará automaticamente este arquivo
# 5. Clique em "Apply" para criar os serviços

services:
  # PostgreSQL Database
  - type: pserv
    name: portal-services-db
    plan: starter
    envVars:
      - key: POSTGRES_USER
        value: admin
      - key: POSTGRES_PASSWORD
        generateValue: true
      - key: POSTGRES_DB
        value: portalservicesdb
    autoDeploy: true

  # Portal Services API
  - type: web
    name: portal-services-api
    runtime: node
    plan: starter
    buildCommand: cd appserver && npm install && npm run build && npm run init-db
    startCommand: cd appserver && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      - key: DB_HOST
        fromService:
          type: pserv
          name: portal-services-db
          property: host
      - key: DB_PORT
        fromService:
          type: pserv
          name: portal-services-db
          property: port
      - key: DB_NAME
        fromService:
          type: pserv
          name: portal-services-db
          property: database
      - key: DB_USER
        fromService:
          type: pserv
          name: portal-services-db
          property: user
      - key: DB_PASSWORD
        fromService:
          type: pserv
          name: portal-services-db
          property: password
      - key: DB_SSL
        value: "true"
      - key: API_URL
        value: https://portal-services-api.onrender.com
      - key: API_BASE_URL
        value: https://portal-services-api.onrender.com
      - key: FRONTEND_URL
        value: https://portal-services-api.onrender.com
      - key: JWT_SECRET
        generateValue: true
      - key: SESSION_SECRET
        generateValue: true
    healthCheckPath: /health
    autoDeploy: true
    pullRequestPreviewsEnabled: true
